{
  "dashboard": {
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "datasource",
            "uid": "grafana"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "target": {
            "limit": 100,
            "matchAny": false,
            "tags": [],
            "type": "dashboard"
          },
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "The average duration of an ad break. Can be down to a single ad break or used as an average. ",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "dtdurations"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 4,
          "w": 8,
          "x": 0,
          "y": 0
        },
        "id": 43,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "/.*/",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \n    AVG(playback_duration_ads) / 1000 AS avg_playback_duration_ads_min\nFROM (\n    SELECT \n        start_event.ad.ad_break_id,\n        MAX(start_event.event.metrics.playback_duration_ads_ms) AS playback_duration_ads\n    FROM $GLUE_TABLE AS start_event\n    JOIN $GLUE_TABLE AS end_event\n        ON start_event.ad.ad_break_id = end_event.ad.ad_break_id\n    WHERE \n        start_event.event.type = 'ad_break_start'\n        AND end_event.event.type = 'ad_break_end'\n    GROUP BY start_event.ad.ad_break_id\n) AS ad_durations;\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Average Ad Break Duration",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 8,
          "y": 0
        },
        "id": 37,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "text": {},
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\nevent.type,\nCOUNT(*) AS events\nFROM\n\t$__table\nWHERE\n\t$__timeFilter(event.timestamp)\n  AND\nevent.type = 'error'\n  AND\nvideo.media_type='ad'\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\nGROUP BY 1\nORDER BY events",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Errors",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "m"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 12,
          "y": 0
        },
        "id": 30,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "text": {},
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \nSUM(playbackDurationAds)/60000\nFROM (\n\t  SELECT user_details.content_session_id,\n\t\tMAX(event.metrics.playback_duration_ads_ms) as playbackDurationAds\n\tFROM $__table\n\t\t    WHERE $__timeFilter(event.timestamp)\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\n\tGROUP BY user_details.content_session_id\n\t)",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Minutes",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "decimals": 3,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 16,
          "y": 0
        },
        "id": 36,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "hide": true,
            "rawSQL": "SELECT\n  (COUNT(DISTINCT ad.ad_session_id))\nFROM\n\t$__table\nWHERE\n\t$__timeFilter(event.timestamp)\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )",
            "refId": "A",
            "table": "$GLUE_TABLE"
          },
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "hide": true,
            "rawSQL": "SELECT\nevent.type,\nCOUNT(*) AS events\nFROM\n\t$__table\n  WHERE\n\t$__timeFilter(event.timestamp)\n  AND\nevent.type = 'ad_break_start'\nAND\nvideo.media_type='ad'\nGROUP BY 1\nORDER BY events",
            "refId": "B",
            "table": "$GLUE_TABLE"
          },
          {
            "datasource": {
              "name": "Expression",
              "type": "__expr__",
              "uid": "__expr__"
            },
            "expression": "$B / $A",
            "hide": false,
            "refId": "C",
            "type": "math"
          }
        ],
        "title": "Ads per Video",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "decimals": 3,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 20,
          "y": 0
        },
        "id": 38,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "hide": true,
            "rawSQL": "SELECT\n  (COUNT(DISTINCT user_details.app_session_id))\nFROM\n\t$__table\nWHERE\n\t$__timeFilter(event.timestamp)\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\n ",
            "refId": "A",
            "table": "$GLUE_TABLE"
          },
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "hide": true,
            "rawSQL": "SELECT\nevent.type,\nCOUNT(*) AS events\nFROM\n\t$__table\n  WHERE\n\t$__timeFilter(event.timestamp)\n  AND\nevent.type = 'ad_break_start'\nAND\nvideo.media_type='ad'\nGROUP BY 1\nORDER BY events",
            "refId": "B",
            "table": "$GLUE_TABLE"
          },
          {
            "datasource": {
              "name": "Expression",
              "type": "__expr__",
              "uid": "__expr__"
            },
            "expression": "$B / $A",
            "hide": false,
            "refId": "C",
            "type": "math"
          }
        ],
        "title": "Ads per App Session",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "This metric creates an average duration of time spent watching content during a series of video views.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "m"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 4,
          "w": 8,
          "x": 0,
          "y": 4
        },
        "id": 42,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \n    AVG(totalTimeWatched) / 60000 AS avg_minutes_watched\nFROM (\n    SELECT \n        user_details.content_session_id,\n        MAX(event.metrics.playback_duration_content_ms) AS totalTimeWatched\n    FROM $__table\n    WHERE \n        $__timeFilter(event.timestamp)\n        AND (\n            '$v_device' = 'All' \n            OR device.device_type = '$v_device'\n        )\n        AND (\n            '$v_app_session' = 'All'\n            OR user_details.app_session_id = '$v_app_session'\n        )\n        AND (\n            '$v_country' = 'All'\n            OR geo_location.country = '$v_country'\n        )\n        AND (\n            '$v_content_session_id' = 'All'\n            OR user_details.content_session_id = '$v_content_session_id'\n        )\n        AND (\n            '$v_city' = 'All'\n            OR geo_location.city = '$v_city'\n        )\n        AND (\n            '$v_os_name' = 'All'\n            OR device.os_name = '$v_os_name'\n        )\n        AND (\n            '$v_os_version' = 'All'\n            OR device.os_version = '$v_os_version'\n        )\n        AND (\n            '$v_asn' = 'All'\n            OR network.asn = '$v_asn'\n        )\n        AND (\n            '$v_page_title' = 'All'\n            OR page.page_title = '$v_page_title'\n        )\n        AND (\n            '$v_mobile_connection' = 'All' \n            OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n        )\n    GROUP BY user_details.content_session_id\n) AS unique_sessions;\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Average Content Watch Time",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "fixedColor": "dark-green",
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "smooth",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "ad_time_offset_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Requests"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "duration_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Errors"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 8,
          "y": 5
        },
        "id": 13,
        "options": {
          "legend": {
            "calcs": [
              "sum"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n  $__timeGroup(event.timestamp, $interval),\n  COUNT(DISTINCT CASE WHEN ((video.media_type) LIKE ('ad')) THEN ad.ad_break_id  ELSE NULL END)  AS \"Ad Opportunity\"\nFROM\n  $__table() \nWHERE\n  $__timeFilter(event.timestamp)\nAND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\nGROUP BY 1\nORDER BY 1 DESC\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Opportunities",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "The rate at which ad requests result in an ad impression. Used to determine if the ad system is filling at an appropriate level or configuration changes to the ad exchange network should be considered.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "fixedColor": "dark-green",
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "smooth",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "max": 100,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "ad_time_offset_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Requests"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "duration_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Errors"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 16,
          "y": 5
        },
        "id": 12,
        "options": {
          "legend": {
            "calcs": [
              "mean"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n   $__timeGroup(event.timestamp, $interval) ,\n((1 - CAST(SUM(CASE WHEN event.type = 'ad_impression'  THEN 1 END) AS double) / CAST(SUM(CASE WHEN video.media_type LIKE ('ad') THEN 1 END) AS double)) * 100) AS \"Ad Fill Rate\"\n\nFROM $__table() \n\nWHERE\n  $__timeFilter(event.timestamp)\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\nGROUP BY\n    1\nORDER BY\n    1 DESC\nLIMIT 500",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Fill Rate",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "This metric reflects the total playback time viewed by users. This KPI is useful for obtaining an understanding of the total time users spent viewing content.\n \n \n \t\nThis metric reflects the total playback time viewed by users. This KPI is useful for obtaining an understanding of the total time users spent viewing content.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "m"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 4,
          "w": 8,
          "x": 0,
          "y": 8
        },
        "id": 41,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \n    SUM(totalTimeWatched) / 60000 AS total_minutes_watched\nFROM (\n    SELECT DISTINCT user_details.content_session_id, \n        MAX(event.metrics.playback_duration_content_ms) OVER (PARTITION BY user_details.content_session_id) AS totalTimeWatched\n    FROM $__table\n    WHERE \n        $__timeFilter(event.timestamp)\n        AND (\n            '$v_device' = 'All' \n            OR device.device_type = '$v_device'\n        )\n        AND (\n            '$v_app_session' = 'All'\n            OR user_details.app_session_id = '$v_app_session'\n        )\n        AND (\n            '$v_country' = 'All'\n            OR geo_location.country = '$v_country'\n        )\n        AND (\n            '$v_content_session_id' = 'All'\n            OR user_details.content_session_id = '$v_content_session_id'\n        )\n        AND (\n            '$v_city' = 'All'\n            OR geo_location.city = '$v_city'\n        )\n        AND (\n            '$v_os_name' = 'All'\n            OR device.os_name = '$v_os_name'\n        )\n        AND (\n            '$v_os_version' = 'All'\n            OR device.os_version = '$v_os_version'\n        )\n        AND (\n            '$v_asn' = 'All'\n            OR network.asn = '$v_asn'\n        )\n        AND (\n            '$v_page_title' = 'All'\n            OR page.page_title = '$v_page_title'\n        )\n        AND (\n            '$v_mobile_connection' = 'All' \n            OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n        )\n\n) AS unique_sessions;\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Total Time Watched",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "Total ad requests",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 0,
          "y": 12
        },
        "id": 32,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "text": {},
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \n    event.type, \n    COUNT(*) AS events\nFROM\n    $__table\nWHERE\n    $__timeFilter(event.timestamp)\n    AND video.media_type = 'ad'\n    AND (\n            '$v_device' = 'All' \n            OR device.device_type = '$v_device'\n        )\n        AND (\n            '$v_app_session' = 'All'\n            OR user_details.app_session_id = '$v_app_session'\n        )\n        AND (\n            '$v_country' = 'All'\n            OR geo_location.country = '$v_country'\n        )\n        AND (\n            '$v_content_session_id' = 'All'\n            OR user_details.content_session_id = '$v_content_session_id'\n        )\n        AND (\n            '$v_city' = 'All'\n            OR geo_location.city = '$v_city'\n        )\n        AND (\n            '$v_os_name' = 'All'\n            OR device.os_name = '$v_os_name'\n        )\n        AND (\n            '$v_os_version' = 'All'\n            OR device.os_version = '$v_os_version'\n        )\n        AND (\n            '$v_asn' = 'All'\n            OR network.asn = '$v_asn'\n        )\n        AND (\n            '$v_page_title' = 'All'\n            OR page.page_title = '$v_page_title'\n        )\n        AND (\n            '$v_mobile_connection' = 'All' \n            OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n        )\nGROUP BY 1\nORDER BY events\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Requests",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "description": "The total number of impressions. Useful revenue indicator that can be broken down by content, user cohort, time of day, etc.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 5,
          "w": 4,
          "x": 4,
          "y": 12
        },
        "id": 40,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "text": {},
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT \n    event.type, \n    COUNT(*) AS events\nFROM\n    $__table\nWHERE\n    $__timeFilter(event.timestamp)\n    AND \n    event.type = 'ad_impression'\n    AND (\n        '$v_device' = 'All' \n        OR device.device_type = '$v_device'\n    )\n    AND (\n        '$v_app_session' = 'All'\n        OR user_details.app_session_id = '$v_app_session'\n    )\n    AND (\n        '$v_country' = 'All'\n        OR geo_location.country = '$v_country'\n    )\n    AND (\n        '$v_content_session_id' = 'All'\n        OR user_details.content_session_id = '$v_content_session_id'\n    )\n    AND (\n        '$v_city' = 'All'\n        OR geo_location.city = '$v_city'\n    )\n    AND (\n        '$v_os_name' = 'All'\n        OR device.os_name = '$v_os_name'\n    )\n    AND (\n        '$v_os_version' = 'All'\n        OR device.os_version = '$v_os_version'\n    )\n    AND (\n        '$v_asn' = 'All'\n        OR network.asn = '$v_asn'\n    )\n    AND (\n        '$v_page_title' = 'All'\n        OR page.page_title = '$v_page_title'\n    )\n    AND (\n        '$v_mobile_connection' = 'All' \n        OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n    )\nGROUP BY 1\nORDER BY events\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Total Ad Impressions",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Ad Error Rate"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Errors"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "short"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Ad Break Drop Off"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 8,
          "y": 14
        },
        "id": 24,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "enablePagination": true,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": [
            {
              "desc": true,
              "displayName": "Ad Error Rate"
            }
          ]
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n  distinct(device.device_type) AS \"Device\",\n  ((1 - CAST(SUM(CASE WHEN event.type = 'ad_break_end'  THEN 1 END) AS double) / CAST(SUM(CASE WHEN event.type = 'ad_break_start' THEN 1 END) AS double)) * 100) AS \"Ad Break Drop Off\"\n\nFROM\n  $__table()\nWHERE\n  $__timeFilter(event.timestamp)\n  AND\n  video.media_type = 'ad'\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\nGROUP by 1\nORDER BY 2 DESC",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Drop Off",
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "smooth",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "max": 100,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 16,
          "y": 14
        },
        "id": 39,
        "options": {
          "legend": {
            "calcs": [
              "mean"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n  $__timeGroup(event.timestamp, $interval),\n  ((1 - CAST(SUM(CASE WHEN event.type = 'playback_complete' THEN 1 END) AS double) / CAST(SUM(CASE WHEN event.type = 'playback_start' THEN 1 END) AS double)) * 100) AS Ad_Completion_Rate\n\nFROM\n$__table() \nWHERE\n  $__timeFilter(event.timestamp) \n  AND\n  video.media_type = 'ad'\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\n\nGROUP by 1\nORDER by 1",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Completion Rate",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "smooth",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 0,
          "y": 17
        },
        "id": 4,
        "options": {
          "legend": {
            "calcs": [
              "sum"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n    $__timeGroup(event.timestamp, $interval) ,\n    COUNT(CASE WHEN ((event.type) LIKE 'ad_impression') THEN 1 ELSE NULL END) AS \"Ad Impressions\"\nFROM\n  $__table() \nWHERE\n  $__timeFilter(event.timestamp)\n  AND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\nGROUP BY 1\nORDER BY 1\n\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Impressions",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "links": [],
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Error Count"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "short"
                },
                {
                  "id": "custom.width",
                  "value": 103
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Error Code"
              },
              "properties": [
                {
                  "id": "custom.width",
                  "value": 125
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 16,
          "x": 8,
          "y": 23
        },
        "id": 21,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "enablePagination": true,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": [
            {
              "desc": true,
              "displayName": "Error Count"
            }
          ]
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n  event.attributes.error_msg AS \"Error Message\",\n  event.attributes.error_code AS \"Error Code\",\n  COUNT(CASE WHEN ((event.type) LIKE 'error') THEN 1 ELSE NULL END) AS \"Error Count\"\nFROM\n  $__table()\nWHERE\n  $__timeFilter(event.timestamp)\nAND\n  video.media_type = 'ad'\nAND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  ) \nGROUP by 1,2\n\n\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Error Details",
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "filterable": false,
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Revenue"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "currencyUSD"
                },
                {
                  "id": "decimals",
                  "value": 2
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Ad Impressions"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "short"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 8,
          "x": 0,
          "y": 26
        },
        "id": 6,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "enablePagination": true,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": [
            {
              "desc": true,
              "displayName": "Ad Impressions"
            }
          ]
        },
        "pluginVersion": "10.4.1",
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n  ad.ad_system AS \"Ad System\",\n  COUNT(CASE WHEN (( event.type  ) LIKE 'ad_impression') THEN 1 ELSE NULL END) AS \"Ad Impressions\"\nFROM $__table() \nWHERE\n  $__timeFilter(event.timestamp)\nAND (\n    '$v_device' = 'All' \n    OR device.device_type = '$v_device'\n)\nAND (\n    '$v_app_session' = 'All'\n    OR user_details.app_session_id = '$v_app_session'\n)\nAND (\n    '$v_country' = 'All'\n    OR geo_location.country = '$v_country'\n)\nAND (\n    '$v_content_session_id' = 'All'\n    OR user_details.content_session_id = '$v_content_session_id'\n)\nAND (\n    '$v_city' = 'All'\n    OR geo_location.city = '$v_city'\n)\nAND (\n    '$v_os_name' = 'All'\n    OR device.os_name = '$v_os_name'\n)\nAND (\n    '$v_os_version' = 'All'\n    OR device.os_version = '$v_os_version'\n)\nAND (\n    '$v_asn' = 'All'\n    OR network.asn = '$v_asn'\n)\nAND (\n    '$v_page_title' = 'All'\n    OR page.page_title = '$v_page_title'\n)\nAND (\n    '$v_mobile_connection' = 'All' \n    OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n)\n  \n  GROUP by 1\n  ORDER by 1\n",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Impressions by Ad System",
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "$DATASOURCE_UUID"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "fixedColor": "dark-green",
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "smooth",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "max": 100,
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "ad_time_offset_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Requests"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "duration_sec"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Ad Errors"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 9,
          "w": 16,
          "x": 8,
          "y": 31
        },
        "id": 11,
        "options": {
          "legend": {
            "calcs": [
              "mean"
            ],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "datasource": {
              "type": "grafana-athena-datasource",
              "uid": "$DATASOURCE_UUID"
            },
            "format": 1,
            "rawSQL": "SELECT\n$__timeGroup(event.timestamp, $interval),\n((1 - CAST(SUM(CASE WHEN event.type = 'error' THEN 1 END) AS double) / CAST(SUM(CASE WHEN event.type = 'media_request' THEN 1 END) AS double)) * 100) AS \"Ad Error Rate\"\nFROM $__table\nWHERE\n  $__timeFilter(event.timestamp)\nAND\n  video.media_type='ad'\nAND (\n      '$v_device' = 'All' \n      OR device.device_type = '$v_device'\n  )\n  AND (\n      '$v_app_session' = 'All'\n      OR user_details.app_session_id = '$v_app_session'\n  )\n  AND (\n      '$v_country' = 'All'\n      OR geo_location.country = '$v_country'\n  )\n  AND (\n      '$v_content_session_id' = 'All'\n      OR user_details.content_session_id = '$v_content_session_id'\n  )\n  AND (\n      '$v_city' = 'All'\n      OR geo_location.city = '$v_city'\n  )\n  AND (\n      '$v_os_name' = 'All'\n      OR device.os_name = '$v_os_name'\n  )\n  AND (\n      '$v_os_version' = 'All'\n      OR device.os_version = '$v_os_version'\n  )\n  AND (\n      '$v_asn' = 'All'\n      OR network.asn = '$v_asn'\n  )\n  AND (\n      '$v_page_title' = 'All'\n      OR page.page_title = '$v_page_title'\n  )\n  AND (\n      '$v_mobile_connection' = 'All' \n      OR network.mobile_connection = CAST('$v_mobile_connection' AS BOOLEAN)\n  )\n\nGROUP BY 1\nORDER BY 1",
            "refId": "A",
            "table": "$GLUE_TABLE"
          }
        ],
        "title": "Ad Error Rate",
        "type": "timeseries"
      }
    ],
    "refresh": "",
    "revision": 1,
    "schemaVersion": 39,
    "tags": [],
    "templating": {
      "list": [
        {
          "auto": true,
          "auto_count": 30,
          "auto_min": "10s",
          "current": {
            "selected": false,
            "text": "auto",
            "value": "$__auto_interval_interval"
          },
          "hide": 0,
          "label": "Interval",
          "name": "interval",
          "options": [
            {
              "selected": true,
              "text": "auto",
              "value": "$__auto_interval_interval"
            },
            {
              "selected": false,
              "text": "1m",
              "value": "1m"
            },
            {
              "selected": false,
              "text": "10m",
              "value": "10m"
            },
            {
              "selected": false,
              "text": "30m",
              "value": "30m"
            },
            {
              "selected": false,
              "text": "1h",
              "value": "1h"
            },
            {
              "selected": false,
              "text": "6h",
              "value": "6h"
            },
            {
              "selected": false,
              "text": "12h",
              "value": "12h"
            },
            {
              "selected": false,
              "text": "1d",
              "value": "1d"
            },
            {
              "selected": false,
              "text": "7d",
              "value": "7d"
            },
            {
              "selected": false,
              "text": "14d",
              "value": "14d"
            },
            {
              "selected": false,
              "text": "30d",
              "value": "30d"
            }
          ],
          "query": "1m,10m,30m,1h,6h,12h,1d,7d,14d,30d",
          "queryValue": "",
          "refresh": 2,
          "skipUrlSync": false,
          "type": "interval"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Describes the type of device category being used during the session such as phone, tablet, desktop, connected device, game console, etc.",
          "hide": 0,
          "includeAll": false,
          "label": "Device",
          "multi": false,
          "name": "v_device",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS Device\nUNION\nSELECT distinct(device.device_type) AS Device\nFROM $__table \nWHERE $__timeFilter(event.timestamp)",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Unique identifier for the user's current Datazoom session. Session will persist as long as the user is viewing content uninterrupted. A 20 minute pause in activity will close the session.",
          "hide": 0,
          "includeAll": false,
          "label": "AppSessionId",
          "multi": false,
          "name": "v_app_session",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS AppSessionId \nUNION \nSELECT DISTINCT user_details.app_session_id AS AppSessionId \nFROM $__table \nWHERE $__timeFilter(event.timestamp)\n",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Full name of the user's country",
          "hide": 0,
          "includeAll": false,
          "label": "Country",
          "multi": false,
          "name": "v_country",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS Country \nUNION \nSELECT DISTINCT geo_location.country AS Country \nFROM $__table \nWHERE $__timeFilter(event.timestamp)\n",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "A unique id for the current video playback session.",
          "hide": 0,
          "includeAll": false,
          "label": "ContentSessionId",
          "multi": false,
          "name": "v_content_session_id",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS ContentSessionId \nUNION \nSELECT DISTINCT user_details.content_session_id AS ContentSessionId \nFROM $__table \nWHERE $__timeFilter(event.timestamp)\n",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "The city or town where the user is located",
          "hide": 0,
          "includeAll": false,
          "label": "City",
          "multi": false,
          "name": "v_city",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS City \nUNION \nSELECT DISTINCT geo_location.city AS City \nFROM $__table \nWHERE $__timeFilter(event.timestamp)\n",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Operating System of the user's device",
          "hide": 0,
          "includeAll": false,
          "label": "OsName",
          "multi": false,
          "name": "v_os_name",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS OS\nUNION\nSELECT distinct(device.os_name) AS OS\nFROM $__table \nWHERE $__timeFilter(event.timestamp)",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Version of Operating System being used during the session",
          "hide": 0,
          "includeAll": false,
          "label": "OsVersion",
          "multi": false,
          "name": "v_os_version",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS OsVersion\nUNION\nSELECT distinct(device.os_version) AS OsVersion\nFROM $__table \nWHERE $__timeFilter(event.timestamp)",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Autonomous System Number: a unique number identifying a group of IP networks that serves the content to the end-user. Client ASN as determined from a lookup of the client IP",
          "hide": 0,
          "includeAll": false,
          "label": "ASN",
          "multi": false,
          "name": "v_asn",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS ASN\nUNION\nSELECT distinct(network.asn) AS ASN\nFROM $__table \nWHERE $__timeFilter(event.timestamp)",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "All"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "The title of the page from which the event originated.",
          "hide": 0,
          "includeAll": false,
          "label": "PageTitle",
          "multi": false,
          "name": "v_page_title",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS PageTitle\nUNION\nSELECT distinct(page.page_title) AS PageTitle\nFROM $__table \nWHERE $__timeFilter(event.timestamp)",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "false",
            "value": "false"
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "$DATASOURCE_UUID"
          },
          "definition": "",
          "description": "Specifies if a user is on a mobile connection as determined by their IP address",
          "hide": 0,
          "includeAll": false,
          "label": "Mobile Connection",
          "multi": false,
          "name": "v_mobile_connection",
          "options": [],
          "query": {
            "connectionArgs": {
              "catalog": "__default",
              "database": "__default",
              "region": "__default",
              "resultReuseEnabled": false,
              "resultReuseMaxAgeInMinutes": 60
            },
            "format": 1,
            "rawSQL": "SELECT 'All' AS MobileConnection\nUNION\nSELECT DISTINCT \n    CASE \n        WHEN network.mobile_connection = TRUE THEN 'true'\n        WHEN network.mobile_connection = FALSE THEN 'false'\n    END AS MobileConnection\nFROM $__table \nWHERE $__timeFilter(event.timestamp);\n",
            "table": "$GLUE_TABLE"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        }
      ]
    },
    "time": {
      "from": "now-7d",
      "to": "now"
    },
    "timepicker": {},
    "timezone": "browser",
    "title": "TrackIt X Datazoom (NAB Demo)",
    "uid": "edq5ky0imp14wfr",
    "version": 34,
    "weekStart": ""
  }
}